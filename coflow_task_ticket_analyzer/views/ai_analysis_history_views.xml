<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- AI Analysis History Tree View -->
    <record id="view_ai_analysis_history_tree" model="ir.ui.view">
        <field name="name">ai.analysis.history.tree</field>
        <field name="model">ai.analysis.history</field>
        <field name="arch" type="xml">
            <tree string="AI Analysis History"
                  decoration-success="complexity_level == 'low'"
                  decoration-info="complexity_level == 'medium'"
                  decoration-warning="complexity_level == 'high'"
                  decoration-danger="complexity_level == 'critical'">
                <field name="create_date"/>
                <field name="task_id"/>
                <field name="ticket_id"/>
                <field name="partner_id"/>
                <field name="complexity_score" widget="progressbar"/>
                <field name="complexity_level" widget="badge"/>
                <field name="estimated_hours"/>
                <field name="ai_model_used"/>
                <field name="status" widget="badge"/>
                <field name="github_action_taken" widget="boolean_toggle"/>
            </tree>
        </field>
    </record>

    <!-- AI Analysis History Form View -->
    <record id="view_ai_analysis_history_form" model="ir.ui.view">
        <field name="name">ai.analysis.history.form</field>
        <field name="model">ai.analysis.history</field>
        <field name="arch" type="xml">
            <form string="AI Analysis History">
                <header>
                    <field name="status" widget="statusbar"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button class="oe_stat_button" name="action_view_related_record" type="object" icon="fa-link">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">View Record</span>
                            </div>
                        </button>
                        <button class="oe_stat_button" name="action_view_github_pr" type="object" icon="fa-github"
                                invisible="not github_pr_url">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">GitHub PR</span>
                            </div>
                        </button>
                    </div>

                    <group>
                        <group string="Analysis Details">
                            <field name="create_date"/>
                            <field name="task_id"/>
                            <field name="ticket_id"/>
                            <field name="partner_id"/>
                            <field name="project_id"/>
                        </group>
                        <group string="AI Results">
                            <field name="complexity_score" widget="progressbar"/>
                            <field name="complexity_level" widget="badge"/>
                            <field name="estimated_hours"/>
                            <field name="ai_model_used"/>
                            <field name="analysis_duration"/>
                        </group>
                    </group>

                    <group string="Solution Suggestion">
                        <field name="solution_suggestion" nolabel="1" widget="html"/>
                    </group>

                    <group string="Code Suggestion" invisible="not code_suggestion">
                        <field name="code_suggestion" nolabel="1" widget="ace" options="{'mode': 'python'}"/>
                    </group>

                    <group>
                        <group string="Similar Records">
                            <field name="similar_records_count"/>
                            <field name="similar_record_ids" widget="text"/>
                        </group>
                        <group string="GitHub Integration">
                            <field name="github_action_taken"/>
                            <field name="github_commit_sha"/>
                            <field name="github_pr_url" widget="url"/>
                        </group>
                    </group>

                    <group string="Analysis Details">
                        <field name="analysis_details" nolabel="1" widget="text"/>
                    </group>

                    <group string="Error Message" invisible="not error_message">
                        <field name="error_message" nolabel="1" widget="text"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- AI Analysis History Search View -->
    <record id="view_ai_analysis_history_search" model="ir.ui.view">
        <field name="name">ai.analysis.history.search</field>
        <field name="model">ai.analysis.history</field>
        <field name="arch" type="xml">
            <search string="AI Analysis History">
                <field name="task_id"/>
                <field name="ticket_id"/>
                <field name="partner_id"/>
                <field name="project_id"/>
                <separator/>
                <filter string="Low Complexity" name="low_complexity"
                        domain="[('complexity_level', '=', 'low')]"/>
                <filter string="Medium Complexity" name="medium_complexity"
                        domain="[('complexity_level', '=', 'medium')]"/>
                <filter string="High Complexity" name="high_complexity"
                        domain="[('complexity_level', '=', 'high')]"/>
                <filter string="Critical Complexity" name="critical_complexity"
                        domain="[('complexity_level', '=', 'critical')]"/>
                <separator/>
                <filter string="Success" name="success"
                        domain="[('status', '=', 'success')]"/>
                <filter string="Failed" name="failed"
                        domain="[('status', '=', 'failed')]"/>
                <separator/>
                <filter string="With GitHub Action" name="with_github"
                        domain="[('github_action_taken', '=', True)]"/>
                <separator/>
                <filter string="This Month" name="this_month"
                        domain="[('create_date', '>=', (context_today() - relativedelta(months=1)).strftime('%Y-%m-01'))]"/>
                <group expand="0" string="Group By">
                    <filter string="Complexity Level" name="group_complexity"
                            context="{'group_by': 'complexity_level'}"/>
                    <filter string="Customer" name="group_partner"
                            context="{'group_by': 'partner_id'}"/>
                    <filter string="Project" name="group_project"
                            context="{'group_by': 'project_id'}"/>
                    <filter string="AI Model" name="group_model"
                            context="{'group_by': 'ai_model_used'}"/>
                    <filter string="Date" name="group_date"
                            context="{'group_by': 'create_date'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- AI Analysis History Action -->
    <record id="action_ai_analysis_history" model="ir.actions.act_window">
        <field name="name">AI Analysis History</field>
        <field name="res_model">ai.analysis.history</field>
        <field name="view_mode">tree,form</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No AI analysis history yet
            </p>
            <p>
                AI analysis history will appear here once you start analyzing tasks and tickets.
            </p>
        </field>
    </record>

    <!-- Menu Item -->
    <menuitem id="menu_ai_analysis_history"
              name="AI Analysis History"
              parent="project.menu_main_pm"
              action="action_ai_analysis_history"
              sequence="99"/>
</odoo>
